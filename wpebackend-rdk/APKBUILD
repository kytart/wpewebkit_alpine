# Maintainer: signageOS <dev@signageos.io>
pkgname="wpebackend-rdk"
pkgver="1.0"
pkgrel=0
pkgdesc="wpebackend-rdk"
url="https://wpewebkit.org"
arch="armhf armv7"
license="custom"
depends="libxkbcommon libwpe raspberrypi libinput"
makedepends="cmake ninja eudev-dev libxkbcommon-dev glib-dev libinput-dev raspberrypi-dev"
options="!check"
_commitid="e3f442523072444c0202b508f3688d9026f9c41f"
source="
    $pkgname-$pkgver.tar.gz::https://github.com/WebPlatformForEmbedded/WPEBackend-rdk/archive/$_commitid.tar.gz
    bcm-rpi-cmake.patch
    fix.patch
"
builddir="$srcdir"/WPEBackend-rdk-$_commitid

build() {
    cd "$builddir"
    cmake \
        -DCMAKE_BUILD_TYPE=RelWithDebInfo \
        -DWPE_INCLUDE_DIRS=/usr/include/wpe-1.0 \
        -DBCM_HOST_INCLUDE_DIRS=/opt/vc/include \
        -DEGL_INCLUDE_DIRS=/opt/vc/include \
        -DBCM_HOST_LIBRARIES=bcm_host \
        -DEGL_LIBRARIES=EGL \
        -DUSE_BACKEND_BCM_RPI=ON \
        -GNinja
    ninja
}

package() {
    cd "$builddir"
    DESTDIR="$pkgdir" ninja install
    mv "$pkgdir"/usr/local/* "$pkgdir"/usr
    rmdir "$pkgdir"/usr/local
}

sha512sums="823039b375b261e489e265c8e602ba1bb443330d8078674a38c1dc376050c01dd08a08bc7976adef9ce95386da88d239922a3ea3e759a316acf51b5e1974d761  wpebackend-rdk-1.0.tar.gz
0686c00956c2814a41cbed4e7df1ccac6e7b1abce81aad26121f8760906e39c75f11f4ba773f4fc05c1a2e2d563b04cfca653d9ab54f118af115e3544461b985  fix.patch"
